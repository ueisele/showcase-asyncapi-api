asyncapi: '2.2.0'

id: 'urn:de.novatec.streetlight.v1'

info:
  title: Streetlight API
  version: '1.0.0'
  description: |
    The Streetlight API allows you to remotely manage the city lights.
  contact:
    name: Streetlight API Support
    url: https://github.com/ueisele/showcase-asyncapi-api
    email: enceladus@uweeisele.eu
    x-project-name: Future Light X10
    x-team-name: Team Enceladus
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'

servers:
  showcase-asyncapi:
    protocol: kafka-secure
    description: Showcase AsyncAPI Kafka Cluster
    url: pkc-lq8v7.eu-central-1.aws.confluent.cloud:9092
    security:
    - creds: []

channels:
  lightmeasured-v1:
    bindings:
      kafka:
        x-partitions: 8
    publish:
      summary: Inform about environmental lighting conditions for a particular streetlight.
      operationId: onLightMeasured
      message:
        name: lightMeasured-v1
        title: Light Measured v1
        contentType: avro/binary
        schemaFormat: application/vnd.apache.avro+json;version=1.9.0
        x-schema-url: "https://raw.githubusercontent.com/ueisele/showcase-asyncapi-api/main/schema/de/novatec/streetlight/measured/v1/LightMeasuredEvent.g1.avsc"
        payload:
          $ref: 'https://raw.githubusercontent.com/ueisele/showcase-asyncapi-api/main/schema/de/novatec/streetlight/measured/v1/LightMeasuredEvent.g1.avsc'
        bindings:
          kafka:
            key:
              type: string
              description: Id of the streetlight.
            bindingVersion: '0.2.0'
        traits:
          - $ref: 'https://raw.githubusercontent.com/microcks/microcks-quickstarters/main/cloud/cloudevents/cloudevents-v1.0.1-asyncapi-trait.yml'            
        examples:
          - summary: Example for Streetlight LightMeasured Event
            headers:
              ce_specversion: "1.0"
              ce_id: "{{uuid()}}"
              ce_source: "/streetlight/550e8400-e29b-11d4-a716-446655440000"
              ce_type: "de.novatec.streetlight.v1"
              ce_time: "{{now(yyyy-MM-dd'T'HH:mm:SS'Z')}}"
              content-type: application/avro
            payload:
              id: "550e8400-e29b-11d4-a716-446655440000"
              lumen: 780
              sentAt: "2021-10-30T10:38:17Z"

components:
  securitySchemes:
    creds:
      type: userPassword
      description: Confluent Cloud API Key and Secret